import os
import random
import tweepy

# ุฌูุจ ุงูููุงุชูุญ ูู GitHub Secrets
API_KEY = os.environ.get("API_KEY")
API_SECRET = os.environ.get("API_SECRET")
ACCESS_TOKEN = os.environ.get("ACCESS_TOKEN")
ACCESS_TOKEN_SECRET = os.environ.get("ACCESS_TOKEN_SECRET")

# ุงูุชุญูู ูู ูุฌูุฏ ุงูููุงุชูุญ
all_keys_present = True
for key_name, key_value in [("API_KEY", API_KEY), ("API_SECRET", API_SECRET),
                            ("ACCESS_TOKEN", ACCESS_TOKEN), ("ACCESS_TOKEN_SECRET", ACCESS_TOKEN_SECRET)]:
    if key_value:
        print(f"โ {key_name} ููุฌูุฏ")
    else:
        print(f"โ {key_name} ุบูุฑ ููุฌูุฏ")
        all_keys_present = False

if not all_keys_present:
    print("โ ุชููู ุงูุจูุช: ุจุนุถ ุงูููุงุชูุญ ููููุฏุฉ")
    exit(1)

# ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู Tweepy API v2
client = tweepy.Client(
    consumer_key=API_KEY,
    consumer_secret=API_SECRET,
    access_token=ACCESS_TOKEN,
    access_token_secret=ACCESS_TOKEN_SECRET
)

# ูุงุฆูุฉ ุงูููุดูุฑุงุช ุงูุญููููุฉ
tweets = [
    "๐ฎ ููุณุฑ ุฃุญูุงู ูุชุฎุตุต! โจ\nุงูุดูุฎ ุฃุจู ููุซ ููุณุฑ ุฃุญูุงูู ุจุฏูุฉ ููู ุงููุชุงุจ ูุงูุณูุฉ ๐\nุชูุงุตู ุนุจุฑ ุงููุงุชุณุงุจ: https://wa.me/966507286134",
    "๐ ุญููุช ุจุดูุก ุบุฑูุจุ ุงุณุชุดุฑ ููุณุฑ ุฃุญูุงู ูุญุชุฑู! ๐\nุชูุณูุฑ ุดุฑุนู ุฏููู ูุฌููุน ุงูุฑุคู ูุงูุฃุญูุงู\nุฑุงุณู ููุณุฑ ุงูุฃุญูุงู ุงูุขู: https://wa.me/966507286134",
    "๐ซ ููุณุฑ ุฃุญูุงู ูุนุชูุฏ ููุฏู ูู ุฎุฏูุฉ ูููุฒุฉ! โฐ\nุชูุณูุฑ ุงุญุชุฑุงูู ุฎูุงู 24 ุณุงุนุฉ ุจุฃุณุนุงุฑ ุชูุงูุณูุฉ ๐\nุชูุงุตู ูุน ููุณุฑ ุงูุฃุญูุงู: https://wa.me/966507286134",
    "๐ ูุญุชุงุฌ ุฅูู ููุณุฑ ุฃุญูุงู ุฎุจูุฑุ ๐\nุงูุดูุฎ ุฃุจู ููุซ ููุณุฑ ุฃุญูุงู ูุชุฎุตุต ุจุชูุณูุฑ ุงูุฑุคู ุจุฏูุฉ\n๐ฌ WhatsApp ููุณุฑ ุงูุฃุญูุงู: https://wa.me/966507286134",
    "๐ ูุฏูู ุญูู ูุญูุฑุ ุงุณุชุดุฑ ููุณุฑ ุฃุญูุงู ูุชูุฑุณ! ๐\nุชูุณูุฑ ุงุญุชุฑุงูู ูุฌููุน ุฃููุงุน ุงูุฃุญูุงู ูุงูุฑุคู\nููุณุฑ ุฃุญูุงู ุนูู WhatsApp: https://wa.me/966507286134",
    "๐ฏ ุฃูุถู ููุณุฑ ุฃุญูุงู ูู ุงูุฎููุฌ! ๐\nุชูุณูุฑ ุนููู ุดุฑุนู ุฏููู ูุฌููุน ุงูุฃุญูุงู\n๐ ุชูุงุตู ูุน ููุณุฑ ุงูุฃุญูุงู: https://wa.me/966507286134",
    "โก ููุณุฑ ุฃุญูุงู ุณุฑูุน ุงูุงุณุชุฌุงุจุฉ! โก\nุชูุณูุฑ ููุฑู ููุฃุญูุงู ูุงูุฑุคู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ\n๐ฒ ููุณุฑ ุฃุญูุงู ุนูู ุงููุงุชุณ: https://wa.me/966507286134",
    "๐ ุชุฌุฑุจุฉ ูููุฒุฉ ูุน ููุณุฑ ุฃุญูุงู ูุญุชุฑู! ๐\nุชูุณูุฑ ุฏููู ููุงุถุญ ูุฌููุน ุฃุญูุงูู\n๐ ููุณุฑ ุงูุฃุญูุงู Abu Laith: https://wa.me/966507286134",
    "๐ ุซูุฉ ูุฎุตูุตูุฉ ูุน ููุณุฑ ุฃุญูุงู ูุนุชูุฏ! ๐\nุชูุณูุฑ ุงุญุชุฑุงูู ูุน ุงูุญูุงุธ ุนูู ุณุฑูุฉ ุงููุนูููุงุช\n๐ค ููุณุฑ ุฃุญูุงู ุซูุฉ: https://wa.me/966507286134",
    "๐ ููุณุฑ ุฃุญูุงู ุจุฎุจุฑุฉ ุฃูุซุฑ ูู 10 ุณููุงุช! ๐\nุขูุงู ุงูุชูุณูุฑุงุช ุงููุงุฌุญุฉ ูุนููุงุก ุฑุงุถูู\nโญ ุชูุงุตู ูุน ููุณุฑ ุงูุฃุญูุงู: https://wa.me/966507286134",
    "โจ ุงุณุชุดุงุฑุฉ ูุฌุงููุฉ ูุน ููุณุฑ ุฃุญูุงู! ๐\nุงุญุตู ุนูู ูุธุฑุฉ ุฃูููุฉ ูุฌุงููุฉ ูุชูุณูุฑ ุญููู\n๐ ููุณุฑ ุฃุญูุงู ูุฌุงูู: https://wa.me/966507286134",
    "๐ฅ ููุณุฑ ุฃุญูุงู ูุชูุงุฌุฏ 24/7! ๐โ๏ธ\nุชูุณูุฑ ููุฑู ูู ุฃู ููุช ุชูุงุณุจู\nโก ููุณุฑ ุฃุญูุงู ุณุฑูุน: https://wa.me/966507286134"
]

# ุชุญููู ุณุฌู ุงูููุดูุฑุงุช ุงูุณุงุจูุฉ
log_file = "log.txt"
if os.path.exists(log_file):
    with open(log_file, "r", encoding="utf-8") as f:
        posted_tweets = [line.strip() for line in f.readlines()]
else:
    posted_tweets = []

# ุงุฎุชูุงุฑ ููุดูุฑ ูู ูุชู ูุดุฑู ุจุนุฏ
available_tweets = [t for t in tweets if t not in posted_tweets]

if not available_tweets:
    print("โ ุชู ูุดุฑ ุฌููุน ุงูููุดูุฑุงุช ุจุงููุนู. ุฅุนุงุฏุฉ ุงูุชุฏููุฑ.")
    posted_tweets = []
    available_tweets = tweets.copy()

tweet = random.choice(available_tweets)

# ูุญุงููุฉ ุงููุดุฑ
try:
    response = client.create_tweet(text=tweet)
    print("โ ุชู ูุดุฑ ุงูุชุบุฑูุฏุฉ:", tweet)
    print("Tweet ID:", response.data["id"])
    
    # ุชุญุฏูุซ ุณุฌู ุงูููุดูุฑุงุช
    posted_tweets.append(tweet)
    with open(log_file, "w", encoding="utf-8") as f:
        for t in posted_tweets:
            f.write(t + "\n")
except Exception as e:
    print("โ ุฎุทุฃ ูู ุงููุดุฑ:", e)
